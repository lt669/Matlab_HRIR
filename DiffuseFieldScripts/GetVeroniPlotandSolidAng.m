function s = GetVeroniPlotandSolidAng(azimuth, elevation, plotflag)

% close all
% clear all
% clc
%
% %xyz = randn(3,n);
%
% azimuth = [90,0,122,180,0,90,0,0,0,0,0,90,180,0,45,135,0,90,0,180,0,21,159,16,74,106,164,0,180,29,0,58,122,29,61,119,151,0,0,10,61,20,30,32,40,45,50,58,60,69,70,90,80,90,100,110,111,120,122,130,135,140,119,148,150,160,170,180,0,29,61,119,151,151,58,122,0,0,180,16,74,106,164,0,180,21,159,0,90,180,45,135,0,0,90,58,180,0,58,122,0,29,61,90,119,151,-151,-119,-90,-61,-29,-122,-58,-58,-90,-135,-45,-90,-159,-21,-164,-106,-74,-16,-122,-58,-151,-151,-119,-61,-29,-170,-160,-150,-148,-119,-140,-135,-130,-122,-120,-111,-110,-100,-90,-80,-90,-70,-69,-60,-58,-50,-45,-40,-32,-30,-20,-61,-10,-151,-119,-61,-29,-122,-58,-29,-164,-106,-74,-16,-159,-21,-90,-135,-45,-90,-90,-122,-90];
% elevation = [21,30,36,148,150,159,160,170,180,40,45,45,45,50,55,55,58,58,32,58,60,60,60,62,62,62,62,69,69,32,70,72,72,75,75,75,75,80,90,90,32,90,90,90,90,90,90,90,90,90,90,32,90,90,90,90,90,90,90,90,90,90,32,90,90,90,90,90,100,105,105,105,105,32,108,108,110,111,111,118,118,118,118,120,32,120,120,122,122,122,125,125,130,135,135,36,135,140,144,144,148,148,148,148,148,148,148,148,148,148,148,144,144,36,135,125,125,122,120,120,118,118,118,118,108,108,32,105,105,105,105,90,90,90,90,32,90,90,90,90,90,90,90,90,90,90,32,90,90,90,90,90,90,90,90,90,90,32,90,75,75,75,75,72,72,32,62,62,62,62,60,60,58,55,55,45,159,36,21]-90;
%

[x, y, z] = sph2cart(azimuth*pi/180, elevation*pi/180, ones(size(azimuth)));

xyz = [x; y; z];

xyz = bsxfun(@rdivide, xyz, sqrt(sum(xyz.^2,1)));

n = length(azimuth);

[P, K, voronoiboundary] = voronoisphere(xyz);


% Compute Solid Angles
s = vcell_solidangle(P, K);


%% Graphic
if plotflag == 1
        f = figure(1);
        clf(f);
        set(f,'Renderer','zbuffer');
        ax = axes('Parent', f);
        hold(ax, 'on');
        axis(ax,'equal');
        
        plot3(ax, xyz(1,:),xyz(2,:),xyz(3,:),'wo');
        clmap = cool();
        ncl = size(clmap,1);
        for k = 1:n
        X = voronoiboundary{k};
        cl = clmap(mod(k,ncl)+1,:);
        fill3(X(1,:),X(2,:),X(3,:),cl,'Parent',ax,'EdgeColor','w');
        end
        axis(ax,'equal');
        axis(ax,[-1 1 -1 1 -1 1]);
        
        f = figure(2);
        clf(f);
        set(f,'Renderer','zbuffer');
        ax = axes('Parent', f);
        hold(ax, 'on');
        %input('Type <CR>: ', 's');
        cla(ax);
        plot3(ax, P(1,:),P(2,:),P(3,:), 'ro');
        for k = 1:n
            V = P(:,K{k});
            V = V(:,[1:end 1]);
            for i=1:length(V)-1
                plot3(ax, V(1,i:i+1),V(2,i:i+1),V(3,i:i+1), 'r', 'Linewidth', 1);
            end
        end
        axis(ax,'equal');
        axis(ax,[-1 1 -1 1 -1 1]);
end
        
